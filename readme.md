# Financial Transactions Anomaly Detection Pipeline

## –ö–æ–¥ –¥–ª—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –æ–±—É—á–µ–Ω–∏—è –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∞–Ω–æ–º–∞–ª–∏–π, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –≥–µ–æ-–¥–∞–Ω–Ω—ã—Ö –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ.

````markdown
## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ pipeline_config.json    # –ö–æ–Ω—Ñ–∏–≥ —Å –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –ø—É—Ç—è–º–∏
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/                    # –ò—Å—Ö–æ–¥–Ω—ã–µ CSV (–Ω–∞–ø—Ä–∏–º–µ—Ä, transactions.csv)
‚îÇ   ‚îî‚îÄ‚îÄ processed/              # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: full_output.csv, anomalies.csv, map.html, –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ run_pipeline.py         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ data_loader.py          # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –±–∞–∑–æ–≤–∞—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ features.py             # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è rolling- –∏ geo-–ø—Ä–∏–∑–Ω–∞–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ clustering.py           # HDBSCAN-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ model.py                # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –æ–±—É—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils.py                # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ ...                     # Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª–µ–π
‚îú‚îÄ‚îÄ requirements.txt            # –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îî‚îÄ‚îÄ README.md                   # –≠—Ç–æ—Ç —Ñ–∞–π–ª
````

---

## ‚öôÔ∏è –ü—Ä–µ—Ä–µ–∫–≤–∏–∑–∏—Ç—ã

* Python 3.8+
* Git
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

  ```bash
  python -m venv .venv
  source .venv/bin/activate    # Linux / macOS
  .venv\Scripts\activate       # Windows PowerShell
  ```

---

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

   ```bash
   git clone https://github.com/K0RTEK/financial_transactions.git
   cd financial_transactions
   ```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø–∞–∫–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

   ```bash
   pip install -e .
   pip install -r requirements.txt
   ```
3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `requirements.txt`:

   ```bash
   pip freeze > requirements.txt
   ```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í —Ñ–∞–π–ª–µ `config/pipeline_config.json` —É–∫–∞–∂–∏—Ç–µ:

* `time_col`: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"transactiontime"`).
* `group_cols`: —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `["carduid"]`).
* `rolling_windows`: –º–∞—Å—Å–∏–≤ –æ–∫–æ–Ω –≤ –º–∏–Ω—É—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[5,10,20,30]`).
* `rolling_stats`: —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ (–æ–±—ã—á–Ω–æ `["count"]`).
* `lat_col`, `lon_col`: –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ —à–∏—Ä–æ—Ç—ã/–¥–æ–ª–≥–æ—Ç—ã.
* `feature_cols`: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Å–º. —à–∞–±–ª–æ–Ω).
* –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ `autoencoder`.
* –ü–æ—Ä–æ–≥–∏ –∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã HDBSCAN.

–ü—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ —Å–º. –≤ `config/pipeline_config.json`.

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
python scripts/run_pipeline.py \
  --config config/pipeline_config.json \
  --input data/raw/transactions.csv \
  --output data/processed/full_output.csv \
  --map data/processed/map.html \
  --model data/processed/model
```

* `--config`  ‚Äî –ø—É—Ç—å –∫ JSON-–∫–æ–Ω—Ñ–∏–≥—É.
* `--input`   ‚Äî CSV —Å —Å—ã—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
* `--output`  ‚Äî –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (full\_output.csv).
* `--map`     ‚Äî –ø—É—Ç—å –¥–ª—è HTML-–∫–∞—Ä—Ç—ã (map.html).
* `--model`   ‚Äî –ø–∞–ø–∫–∞/—Ñ–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç:

* `data/processed/full_output.csv` ‚Äî –ø–æ–ª–Ω—ã–π —Ñ—Ä–µ–π–º —Å —Ñ–∏—á–∞–º–∏ –∏ –º–µ—Ç–∫–∞–º–∏.
* `data/processed/anomalies.csv` ‚Äî —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏, –ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏—è–º–∏.
* `data/processed/map.html` ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏.
* `data/processed/model/` ‚Äî —Ñ–∞–π–ª—ã –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞.

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ unit-—Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ `pytest`:

```bash
pytest --maxfail=1 --disable-warnings -q
```

---

## üìö –ü—Ä–∏–º–µ—Ä—ã

1. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ–∏—á–µ–π –∑–∞ —Ä–∞–∑–Ω—ã–µ –æ–∫–Ω–∞:

   ```bash
   python scripts/run_pipeline.py \
     --config config/pipeline_config.json \
     --input data/raw/transactions.csv \
     --output data/processed/full_output.csv
   ```
2. –¢–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–¥–µ–ª—å:

   ```bash
   python scripts/run_pipeline.py \
     --config config/pipeline_config.json \
     --input data/raw/transactions.csv \
     --model data/processed/model
   ```